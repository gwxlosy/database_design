<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>人员管理 - 列表</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<header class="navbar">
    <div class="navbar-brand">印刷出版商数据库管理系统</div>
    <nav class="navbar-links">
        <a href="{{ url_for('index') }}">首页</a>
        <a href="{{ url_for('books_list') }}">书籍管理</a>
        <a href="{{ url_for('list_tasks') }}">印刷任务</a>
        <a href="{{ url_for('inventory_overview') }}">库存管理</a>
        <a href="{{ url_for('employees_list') }}" class="active">人员管理</a>
        {% if current_user %}
            <a href="{{ url_for('change_password') }}">修改密码</a>
            <span style="margin-left: 1rem; color: #ecf0f1;">{{ current_user.username }} ({{ current_user.position }})</span>
            <a href="{{ url_for('logout') }}">登出</a>
        {% else %}
            <a href="{{ url_for('login') }}">登录</a>
        {% endif %}
    </nav>
</header>
<main class="container">
    <div class="page-header">
        <h1>人员管理</h1>
        {% if is_admin or (current_user and current_user.position == '人事') %}
            <a href="{{ url_for('employees_new') }}" class="btn primary">新增员工</a>
        {% endif %}
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="messages">
                {% for category, message in messages %}
                    <div class="alert {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <form method="get" class="filters" style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin:12px 0;">
        <label for="name">员工姓名：</label>
        <input type="text" id="name" name="name" value="{{ name or '' }}" placeholder="输入姓名关键字" style="min-width:180px;">
        <label for="position">职位：</label>
        <select id="position" name="position">
            <option value="" {% if not position %}selected{% endif %}>全部</option>
            {% for p in positions %}
                <option value="{{ p }}" {% if position==p %}selected{% endif %}>{{ p }}</option>
            {% endfor %}
        </select>
        <label for="status">在职状态：</label>
        <select id="status" name="status">
            <option value="" {% if not status %}selected{% endif %}>全部</option>
            <option value="在职" {% if status=='在职' %}selected{% endif %}>在职</option>
            <option value="离职" {% if status=='离职' %}selected{% endif %}>离职</option>
        </select>
        <label for="sort">排序：</label>
        <select id="sort" name="sort">
            <option value="id_desc" {% if sort=='id_desc' or not sort %}selected{% endif %}>ID降序</option>
            <option value="id_asc" {% if sort=='id_asc' %}selected{% endif %}>ID升序</option>
        </select>
        <label for="page_size">每页：</label>
        <input type="number" id="page_size" name="page_size" min="1" max="200" value="{{ page_data['page_size'] if page_data else 10 }}" style="width:80px;">
        <button type="submit" class="btn">筛选</button>
        <a class="btn" href="{{ url_for('employees_list') }}">重置</a>
    </form>

    {% set items = page_data['items'] if page_data else [] %}
    {% if items and items|length > 0 %}
        <table class="table">
            <thead>
            <tr>
                <th>员工ID</th>
                <th>员工姓名</th>
                <th>职位</th>
                <th>在职状态</th>
                <th>入职日期</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {% for e in items %}
                <tr>
                    <td>{{ e['员工id'] }}</td>
                    <td>{{ e['员工姓名'] }}</td>
                    <td>{{ e['职位'] }}</td>
                    <td>{{ e['在职状态'] }}</td>
                    <td>{{ e['入职日期'] }}</td>
                    <td>
                        {% if is_admin or (current_user and current_user.position == '人事') %}
                            <a href="{{ url_for('employees_account', employee_id=e['员工id']) }}" class="btn">账号</a>
                            <a href="{{ url_for('employees_edit', employee_id=e['员工id']) }}" class="btn">编辑</a>
                        {% else %}
                            <span style="color: #999;">无权限</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% set total = page_data['total'] %}
        {% set page = page_data['page'] %}
        {% set page_size = page_data['page_size'] %}
        {% set total_pages = (total + page_size - 1) // page_size %}
        <div class="pagination" style="margin-top:12px; display:flex; gap:8px; align-items:center;">
            <span>第 {{ page }} / {{ total_pages }} 页（共 {{ total }} 条）</span>
            {% if page > 1 %}
                <a class="btn" href="{{ url_for('employees_list', page=1, page_size=page_size, status=status, position=position, name=name) }}">首页</a>
                <a class="btn" href="{{ url_for('employees_list', page=page-1, page_size=page_size, status=status, position=position, name=name) }}">上一页</a>
            {% endif %}
            {% if page < total_pages %}
                <a class="btn" href="{{ url_for('employees_list', page=page+1, page_size=page_size, status=status, position=position) }}">下一页</a>
                <a class="btn" href="{{ url_for('employees_list', page=total_pages, page_size=page_size, status=status, position=position) }}">末页</a>
            {% endif %}
        </div>
    {% else %}
        <p>暂无员工数据。</p>
    {% endif %}
</main>
</body>
</html>

